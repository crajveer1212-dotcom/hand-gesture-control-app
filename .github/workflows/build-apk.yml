name: Build APK with Docker

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3
    
    - name: Build APK using Docker
      run: |
        docker build -t hand-gesture-builder .
        docker create --name temp-container hand-gesture-builder
        docker cp temp-container:/app/app/build/outputs/apk/debug/app-debug.apk ./app-debug.apk
        docker rm temp-container
    
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: hand-gesture-control-apk
        path: app-debug.apk
        retention-days: 90
    
    - name: Create Release
      if: github.ref == 'refs/heads/main'
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v1.0.${{ github.run_number }}
        name: Hand Gesture Control v1.0.${{ github.run_number }}
        body: |
          ## ğŸ‘‹ Hand Gesture Control App
          
          Control your Android phone with hand gestures!
          
          ### âœ¨ Features:
          - ğŸ‘† Point to tap/select - Hold finger still for 1 second
          - â†”ï¸ Swipe gestures - Scroll next/previous  
          - ğŸ¤ Pinch zoom - Thumb + index finger (automatic)
          - ğŸ–ï¸ Activation gesture - Two fingers to enable
          - â¸ï¸ Auto-pause - When hand not visible or out of range
          - ğŸ”‹ Battery optimized - 15 FPS, process every 3rd frame
          - ğŸ“± Works offline - No internet needed
          - ğŸ“· Front camera only - Lower power consumption
          
          ### ğŸ“¥ Installation:
          1. Download `app-debug.apk` below
          2. Enable "Install from Unknown Sources" in Android settings
          3. Install the APK
          4. Grant Camera, Overlay, and Accessibility permissions
          5. Start using hand gestures!
          
          ### ğŸ“‹ Requirements:
          - Android 7.0 (API 24) or higher
          - Front-facing camera
          - Minimum 2GB RAM
        files: app-debug.apk
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
